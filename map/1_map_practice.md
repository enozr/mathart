
## 实践
## api撕逼大战
bat（百度、高德、腾讯）都有自己的地图，国外也有很多地图。但商业地图往往不开源，我们容易比较

| 需求        | 商业地图           | 开源地图  |
| ------------- |:-------------:| -----:|
| 开源(底层可定制性)      | 否| 是 |
| 全面     | 更全      |  专注地图绘图 |
| 轻量 | 总体不错      |    更好 |
在开源的库里，我们选择了leaflet, 首先leaf只有33k，非常小，摈弃了很多多余的功能，并

## 怎样画点图
####最小原型
甲方: 在地图上画一个点（圆形），代表移动基站。
序猿: 我考 简单，画个圆，大小40像素。leaflet自带的方法就很方便啊。
```javascript
var map = L.map('container', {'center': [22.322527221056657, 114.21292304992676], 'zoom': 13});
var latlng = [22.322527221056657, 114.21292304992676];
var radius = 20;
var circle =L.circleMarker(latlng, radius).addTo(map);
```
这样，我们画了一个中心位于画面中心的圆，直径40px, 这个大小与地图缩放无关。
#### 缩放问题。
甲方：哥们，需求不是这样的，这个点是个基站，有一定的辐射范围，1km，你不能放到杭州这么大，缩到全国也那么大吧
序猿: 我艹，不过也没问题 一行分分钟搞定 L.circleMarker -> L.circle
```javascript
var map = L.map('container', {'center': [22.322527221056657, 114.21292304992676], 'zoom': 13});
var latlng = [22.322527221056657, 114.21292304992676];
var radius = 1000;//单位:米
var circle =L.circle(latlng, radius).addTo(map);
```
#### 数量不止是一个
甲方：哥们， 你别乐着，我有好几多个基站呢，每个辐射圈都不一样的哦。
序猿: 毛，不早说。不过这有啥。
```javascript
var map = L.map('container', {'center': [22.322527221056657, 114.21292304992676], 'zoom': 13});
var data = [{pos:[30, 120],radius:1000}, {pos:[30.1, 120.1],radius:800}];//省略多余的
for(var i in data){
  var d = data[i];
  L.circle(d.latlng, d.radius).addTo(map);
}
```
#### 数量继续增加
甲方：哥们， 你不行，导入数据直接卡死，我们这有10000个基站呢。
序猿：好吧，这咋办，这circle画到几千个就卡死了，你丫破电脑，逼我换方案么。
不过，序猿苦苦搜寻，发现一个cluster的库，这个库可以把临近的点聚合到一起显示一个总数。
```html
增加一个canvas节点 大小和地图等大，放在地图层上方
```
```javascript
var map = L.map('container', {'center': [22.322527221056657, 114.21292304992676], 'zoom': 13});
var data = [{pos:[30, 120],radius:1000}, {pos:[30.1, 120.1],radius:800}];//省略多余的
}
```
#### 要求真实位置。
甲方: 哥们，你这程序看起来是很吊，但我们老板希望显示完全真实的位置，你这cluster，缩放一下，一个点都不知道挪哪里去了，你看看人家google earth，挪到日本，打开地震图层，多牛逼， 几万次地震人家画的好好的，你咋不学学呢。
序猿: 我考 google earth, 这厮是按照地震的等级分的， 大地震一直显示在地图上，小地震到了缩放很大的时候才显示。所以，一个数据是否要显示 取决于两点，一个是他的重要性高不高，一个是地图的缩放等级大不大。
序猿想，这就是一个filter函数的问题嘛,输入一个数据，判断是否需要绘制
```javascript
function filter(value, zoom){
  //省略很多行..............
  return bol;
}
```
在地图缩放发生时，遍历所有的数据，判断是否要画，要就建立一个圆。
。。。。
在这里，问题又来了。当我们缩放的时候，

#### 坑爹的百度地图。

##### 大量点需交互 markerCluster
没关系，我自己建一个canvas，canvas上画很多点很方便吧。
##### 大量点无需交互 heatmap canvas点图

### 把握美
地图本身就很美，而且美在不同的尺度，几年前经常旅行得时候，我曾彻夜不眠地看google earth，从外太空的视角蓝色的星球，到西藏南部的山脉和水网，再小到呼伦贝尔草原上的一条蛇曲的河流，他们都有着精致的结构，在人类文明所留下的地理痕迹，也充满了难以名状的机理美，
地球上的数据也很美，手机定位数据点亮大地，展现出一种复杂的分布。

## 60分到90分之路 dmap 

###数据库
##### geohash

| 精度        | 误差(米)           |
| ------------- |:-------------:|
|1 |  ±2500 |
|2 |  ±630 |
|3 |  ±78 |
|4 |  ±20 |
|5 |  ±2.4 |
|6 |  ±0.61 |
|7 |  ±0.076 |
|8 |  ±0.019 |
|9 |  ±0.0024 |
|10|  ±0.00060 |
|11|  ±0.000074 |



参考
[谷歌地图与开放式API](http://www.thinkgis.cn/topic/5419a086bcea5603e8055ac1)







