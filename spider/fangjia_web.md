
# 爬虫

## 缘起
  年初，上海的房价一夜沸腾，到处都是月上涨百万的房子和日跳价十万的交易，以及人满为患的房地产交易中心。最近某日我打开滴滴快车，刚输入虹口，居然发现自动补出'虹口区房地产交易中心'， 而且排名第一...

  作为数据狗，俺自然去找分析报告了。但然而看起来大多有关地产的数据分析都比较宏观，比如整个深圳的库存和买卖的关系，银行的政策和股市的兴衰对房价的影响，各个城市的房价和收入比如何, 等等。 作为一个小市民，俺的问题就是那么直白: 哪里涨的快？！！ 有没有更性感一点的问题呢？
   
  话说，前几段的文字写多了，为了阻止为俺点赞的同学流失，先放个去年上海的房价增长地图😄

  ![image](http://open-wedding.qiniudn.com/img-house-map_growth_small.jpg)
  
  <!-- 总体，我觉得预测未来很难，房子能涨多少，和金融政策、地产政策、未来规划都有关。对于政策，也许每任领导有各自的思路。分析过去，分析现在还是有用的？ -->

## 技术选择
  俺用node.js写了个爬虫框架，开始数据之旅，如果对爬虫感兴趣，可以看看俺的[这篇文章](./spider.html)



 


## 目标网站
  有许多房价网站，有些乱的就像论坛，信息杂糅，也有些虚假繁荣，重复率高，一套房子都能出现好几次。

  俺就这样爱上了链家和搜房，链家近年野蛮收购，声势浩大，一夜间搞绿了多少街边商铺，而且自称数据准确（相对而言是这样），但链家只做精做深一线城市，而且几年前的数据看起来并不是很多，此外链家没有租房数据(旧主页有丁丁租房的连接)。相比搜房网是历史久远的老牌网站，积淀多一点，搜房虽然较为全面，但传说做低房价，数据不准，而且网站的组织比链家乱一些。

  链家和搜房组织页面的逻辑是简单的，首先，按照城市区分，每个城市是个二级域名，如上海链家的房价页面都是 ```http://sh.lianjia.com/``` 打头的, 杭州则是```http://hz.lianjia.com/``` 

  对于房子，宏观而言，至少分为2个大的对象，一是小区，二是房源。一个小区有很多户型，高低、面积、户型、类型甚至年代各不相同，房源则涉及到具体的交易(当然复杂的情况下，一个房源在不同的时间能有多次交易)。每次交易有很多细节的信息，甚至细到最后一次看房的时间，一个月内看房的次数等等，但亲身经历告诉我，这些很细的指标有时也少登记漏登记，准性没那么高。

  细的也不谈了，总之经过多次爬取或清洗，我的数据库里存了几张表，比如链家网的表有两张：

  小区表: 小区名字，经纬度，边界信息，建成年代，物业公司，开发商，绿化率，容积率，楼房数，房间数，12个月的房价变化等。

  交易表: 所属小区，总价，均价，面积，户型，楼层，房龄，装修，七天里多少人看过，历史上度少人看过，已经完成 & 历史上交易时间等。

  提前说一嘴，链家和搜房的数据是有所滞后性的，正在交易的房子，很多已是过去的价格了，而已成交的房子，成交的时间要倒退几个月才是发生交易的价格，何况为了避税，很多人在签署交易价格的时候会做低房价。


## 上海有多少房子？

从链家爬取的小区信息非常详细，包括每个小区楼房的数量和房间的数量，其实搜房也有，估摸是从政府拿到的，因为即使某个小区没有交易，这个小区的数据都还有，从这个数据，我count了上海房间总量，约600万左右，上海的人口是2000万，平均3点几个人是能有一栋房子的。

这个值应该不是很夸张吧，三口之家都应该有房。


## 政策的威力

房子是一种深受政策影响的东西，管中窥豹，我通过链家的数据，看什么样面积的房子最多？惊奇地发现 89平的房最多，多的畸形，画出来就像一把利剑，这是什么鬼？

这个理由也很简单，有一个政策是: 90平米以下契税征收为1%，90平米--144平米契税为1.5%。144平米以上为3%，所以地产公司肯定料到，愿意住90平和144平以上一点点的的人，肯定愿意为了避税，忍忍住小一点的房。所以，这就是这个曲线的中间和右边的有两个峰值的原因，而40-50平还有个峰值，应该是老房子的标配的缘故吧。

![image](http://open-wedding.qiniudn.com/img-house-areas_count_small.jpg)

此外，这个政策出现在2006年，诨名『7090政策』，当年政府出来抑制房价上涨定的（2006年恰好也是近年来商品房建成最多的一年）。为了验证这个，我们列一下2006年之前房屋面积的分布(还是有几个小波峰，毕竟数据取自正在交易的房源，并非全量的房子，所以契税政策还是会对交易政策产生一定的影响)：

![image](http://open-wedding.qiniudn.com/img-house-areas_count_2006_small.jpg)

## 房价为啥高

在知乎上众多回答里，我很感兴趣的是这个答案 [中国楼市房价是否会崩溃？何时崩溃 莫名的回答](https://www.zhihu.com/question/19618421)。

复述一下，美国是一个州和州制度差异很大的地方，在不同的地区不同的制度，演化出了不同的房价。有研究对美国、澳州26个房价超高的城市的研究表明，其中有23个都有严格的“可持续发展”法案，比如旧金山湾区，5 / 6的土地是不能开发的，这么整，房价怎么会不高。

而一些城市，比如Houston，全美第4大城市，收入很高，但房价却是美国前15的低, 有钱并没有说明房价一定高。

我认同，供求关系才是王道。

看看我们的国家呗，这里是上海，我们的数据也可以反推这一点，因为每个小区都有建成的年代和内含的楼房数和房间数，我们把近30年来按照年代进行累加，得到下图了。

整个曲线横跨1900年-2017年，没错，房子的建成年代还有2017年，因为链家已经把一些期房也考虑在里面了。

06年以后，楼房的建设量一路往下走，13年之后，转向更加剧烈的下滑。

事实上，这段时间里，上海的人口也日趋饱和，直到去年出现负增长。有意思的是，知乎上还有[答案](https://www.zhihu.com/question/40889947/answer/88842301?from=profile_answer_card)从多角度论证上海市人口确实下跌。但房屋供应下降的更快，供需关系还是那么强烈。在这个过程中，政府用压低土地出让量小心翼翼地维持着高房价。

![image](http://open-wedding.qiniudn.com/img-house-count_growth_small.jpg)

这个曲线还有个问题，1994年建成房屋量超过了之后的任何时候。为什么？直到俺问了地产行业的学弟虾米皮同学才恍然大悟。1993年是全国性的房产热。那时候全国都掀起了盖房的热潮，而很多房子了94年房价下跌和调控的时候才刚刚建成。


## 房价哪里高

   感觉里，上海的发展比较分散，杨浦、徐汇、黄浦、浦东都有很多繁华的地段，各为中心。然而如果关注到均价十万以上的近百个小区(别墅），这些点却基本排列在一条东西走向的直线上， 西起佘山，路过西郊宾馆一带(如檀宫)，最多的分布是在徐家汇的老洋房(还记得陈良宇当年的马勒别墅么),然后穿过静安区和黄浦区，浦东五道口周边，最后一直到世纪公园周围。

   ![image](http://open-wedding.qiniudn.com/img-house-soufang_more_4w.png)
   

   如果我们把低于十万/平的房子去掉，这个线更加明显。
   ![image](http://open-wedding.qiniudn.com/img-house-soufang_more_10w.jpg)

   对此，我忽然产生了一个猜测，上海十三五规划，提到大力发展虹桥以西的地区，目前涨的也比较厉害，那这条最昂贵的线会不会一路向西，继续填补版图上的空白呢？

## 卖房哪里多
  贵的房子不一定好卖，有些房子有价无市。比如北京的胡同和上海的洋房，动辄上亿，不是谁都买的起，中产阶级才是消费主力。
  在搜房的数据，对每个小区，有成交次数一项，因此我们可以窥测，哪些盘买卖最多。
  相对于高价房，交易量大的区域比较分散，比如莘庄、三林，之中也包含一些很贵的区域，比如新天地周边的(不幸的是，看链家今年的数据，去年基本没涨幅)
  ![image](http://open-wedding.qiniudn.com/img-house-soufang_sales.jpg)

## 租房哪里多
  好租的房子明显又是另一道风景,掏空了市区点亮了郊区。
  大部分亮点，都比较容易看到逻辑，比如张江园区附近的，上海交大附近的，浦东五道口附近的，松江大学城附近的，等等。
  我想到的原因也比较明显，第一是，小区大了，出租肯定就多，大小区当然郊区多，二是人口聚居地普遍在郊区，学校和大公司，现在都往郊区迁。
  ![image](http://open-wedding.qiniudn.com/img-house-soufang_rent.jpg)


   相信大家更关注房子涨价的逻辑。


## 涨价.7w左右的房子

   许多人说，房价越贵，涨得越快。在收藏品、奢侈品上也是如此。俺屌丝：去你丫的，匡我呢！买实惠点的不好么，投资风险也小。

   然而，当我把上海市目前的房价按照1000分段，和在过去一年的上涨幅度画成这么张图的时候，这个道理多少是对的，而且关系很明显:

   在上海，去年买今年7万左右的房子是涨幅最快的，但过了7万/平，这个收益就开始回落了。此外，我把交易总量也用灰线画出来了，毕竟样本很少的时候，什么结论都有可能发生。

  ![image](http://open-wedding.qiniudn.com/img-house-price_growth_small.jpg)


## 涨价.买市中心？

   那么，是不是地段越好，涨得越快呢？我把所有小区对了经纬度，画在地图上, 由于去年上涨普遍比较凶猛，我以20%为界限，没有到这个涨幅的，都标记成蓝色，超过的是红色，红色越大上涨越多，蓝色越大下跌越多。

   ![image](http://open-wedding.qiniudn.com/img-house-map_growth_small.jpg)

   
   我们看到，有几个区域比较明显，比如浦东陆家嘴及东、莘庄和七宝、浦东徐泾、普陀真如、杨浦新江湾城、宝山宝杨码头附近。

   我放大两个图，第一个是浦东陆家嘴周边，很有意思，陆家嘴的房子普遍涨了，但最好的江畔地段明显涨价一般，而靠近东边的地段却涨势汹汹，而这些房子，价格就在刚才提到的6-7万左右。

   所以，总体上，就去年而言，不能买最好的地段，估值已经太高，退而求其次，周边的地方涨幅倒是可以。

   ![image](http://open-wedding.qiniudn.com/img-house-pudong_growth_small.jpg)
   
## 涨价.买谁家房子？

   看这看那，房子tm太难选了，不过，房子是不是也有名牌效应呢，选了哪家造的房子，成功率就高一点呢？总有哪家选更好的地，造更好的楼，相对更低廉的价格。

   因此，这里统计了所有开发公司在上海的项目去年的平均涨幅。

   不过真实的数据是，排在最前沿的都是在沪只有1-2个项目的公司，总让人感觉这是运气好的缘故，所以，我又加了一个条件，在沪必须开发过超过8个项目

   ![image](http://open-wedding.qiniudn.com/img-house-company_growth_small.jpg)

   <!-- 宝山区的房子 -->

## 老房子还是新房子好
   
   曾经住在老小区，周围都是一群闲散的大爷大妈，每天出门，都有一种重返90年代或者提前32年后俺退休的感觉，无时不刻，我都想逃离这里。

   所以，俺的概念里，新小区必须比老小区居住舒适，价格昂贵，增值潜力大.....

   数据好像残忍地否定了我。

   首先看均价和小区建成年代的关系,这个关系真是亮瞎了我的狗眼，房子越老，价格越高，我只能这么理解这件事了，城市扩张，越老的房子越位于城市的中心，此外，拆迁办大浪淘沙，留下并在交易的老房子本身质量就较好，特别是解放前的...:
    ![image](http://open-wedding.qiniudn.com/img-house-price_age_small.jpg)

   去年一年的增长情况，也并没有体现出新房子的绝对优势，这条线好像是平的:
   ![image](http://open-wedding.qiniudn.com/img-house-age_growth_small.jpg)



  

<!-- 
   实话说，房价的因素多，很多判断规律不明显，有些规律有悖直觉，你认为老房子贵还是新房子贵？
   ![image](http://open-wedding.qiniudn.com/img-house-year_price_small.jpg) -->


